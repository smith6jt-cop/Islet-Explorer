● Here's a summary of everything implemented for Phase 2:

  Files Created                                                                                                                                  
  
  File: notebooks/scvi_qc_validation.ipynb                                                                                                       
  Purpose: scVI batch correction quality validation — silhouette scores, LISI, PCA vs scVI UMAP, per-donor cell type distributions, 6533
    verification
  ────────────────────────────────────────
  File: notebooks/rebuild_trajectory.ipynb
  Purpose: Regenerate trajectory from fixed pipeline — loads islets_core_fixed.h5ad (or regenerates), scVI neighbors (n=15, cosine), PAGA→UMAP,
    DPT, validates INS/GCG correlations and donor ordering
  ────────────────────────────────────────
  File: scripts/build_h5ad_for_app.py
  Purpose: Build enriched H5AD — merges validated trajectory with groovy exports (targets/markers/composition) and donor metadata into
    data/islet_explorer.h5ad
  ────────────────────────────────────────
  File: data/DATA_PROVENANCE.md
  Purpose: Documents canonical H5AD lineage, data sources, deprecated files, and validation criteria

  Files Modified

  File: app/shiny_app/R/data_loading.R
  Changes: Added load_master_h5ad(), reconstruct_groovy_df(), load_master_auto() — H5AD loading with Excel fallback
  ────────────────────────────────────────
  File: app/shiny_app/R/00_globals.R
  Changes: Added h5ad_path constant pointing to data/islet_explorer.h5ad
  ────────────────────────────────────────
  File: app/shiny_app/app.R
  Changes: Updated validate_file and master reactives to use load_master_auto() — tries H5AD first, falls back to Excel

  Execution Order

  The notebooks and scripts should be run in this order:

  1. notebooks/scvi_qc_validation.ipynb — validate scVI is working (uses scvi-env conda)
  2. notebooks/rebuild_trajectory.ipynb — regenerate data/adata_ins_root.h5ad (uses scvi-env)
  3. scripts/build_h5ad_for_app.py — build data/islet_explorer.h5ad
  4. The Shiny app will automatically use the H5AD if present, falling back to Excel

  Key Design Decisions

  - Backward compatible: The app still works with just master_results.xlsx (no H5AD required)
  - Groovy data stored in .uns as column arrays — reconstructed into DataFrames by reconstruct_groovy_df()
  - Same output interface: load_master_auto() returns list(markers, targets, comp, lgals3) — identical to load_master(), so prep_data() needs
  zero changes
  - Python env: Both notebooks use the scvi-env conda environment (/home/smith6jt/miniconda3/envs/scvi-env/) which has scanpy, anndata, scvi,
  sklearn, and scib-metrics installed